import{a as ie}from"./chunk-ABOBCSHE.js";import{A as z,b as k,d as w,e as P,f as M,g as x,h as C,i as T,k as O,n as V,p as K,q as Q,s as W,t as Z,v as G}from"./chunk-L7HYSWOG.js";import{g as B,i as ee,j as te}from"./chunk-QFFBEC2S.js";import"./chunk-LCCYGYQT.js";import{Aa as p,Ba as u,Bb as N,Ca as $,Da as H,Ea as q,Fa as d,Ga as i,Ha as n,Ia as S,O as _,Oa as F,P as f,Pb as R,Qa as g,Qb as I,Sa as m,Tb as y,Ub as A,a as b,ab as r,b as D,bb as U,cb as h,eb as J,gb as X,ha as s,la as c,oa as L,u as j}from"./chunk-M53X7M2I.js";var me=["class","component"],ce=()=>[10,20,30,50];function pe(a,o){a&1&&(i(0,"div",10),S(1,"app-loading-page"),n())}function ue(a,o){if(a&1&&(i(0,"div",11),S(1,"app-error-page",12),n()),a&2){let e=m();s(),d("errorData",e.errorData)}}function ge(a,o){if(a&1){let e=F();i(0,"tr")(1,"td"),r(2),n(),i(3,"td"),r(4),n(),i(5,"td")(6,"button",19),g("click",function(){let l=_(e).$implicit,v=m(2);return f(v.getSessionStudentDetails(l.name))}),r(7,"Student List"),n()()()}if(a&2){let e=o.$implicit,t=o.$index;s(2),U(t+1),s(2),U(e.name)}}function Se(a,o){if(a&1&&(i(0,"option",22),r(1),n()),a&2){let e=o.$implicit;d("value",e),s(),h(" ",e," ")}}function _e(a,o){if(a&1){let e=F();i(0,"div",15)(1,"div",20)(2,"label"),r(3,"Items per page:"),n(),i(4,"select",21),g("change",function(l){_(e);let v=m(2);return f(v.onPageSizeChange(l))}),H(5,Se,2,2,"option",22,$),n(),i(7,"span"),r(8),n(),i(9,"button",23),g("click",function(){_(e);let l=m(2);return f(l.goToFirstPage())}),r(10," \xAB "),n(),i(11,"button",23),g("click",function(){_(e);let l=m(2);return f(l.goToPreviousPage())}),r(12," \u2039 "),n(),i(13,"button",23),g("click",function(){_(e);let l=m(2);return f(l.goToNextPage())}),r(14," \u203A "),n(),i(15,"button",23),g("click",function(){_(e);let l=m(2);return f(l.goToLastPage())}),r(16," \xBB "),n()()()}if(a&2){let e=m(2);s(4),d("value",e.pageSize),s(),q(X(8,ce)),s(3),J("",e.pageNumber*e.pageSize+1," - ",e.getEndItemIndex()," of ",e.totalRecords),s(),d("disabled",e.pageNumber===0),s(2),d("disabled",e.pageNumber===0),s(2),d("disabled",e.pageNumber+1>=e.totalPages),s(2),d("disabled",e.pageNumber+1>=e.totalPages)}}function fe(a,o){a&1&&S(0,"span",18)}function he(a,o){if(a&1){let e=F();i(0,"div",13)(1,"table",14)(2,"thead")(3,"tr")(4,"th"),r(5,"Sl.No"),n(),i(6,"th"),r(7,"Academic Year"),n(),i(8,"th"),r(9,"Actions"),n()()(),i(10,"tbody"),H(11,ge,8,2,"tr",null,$),n()()(),p(13,_e,17,9,"div",15),i(14,"div",16)(15,"button",17),g("click",function(){_(e);let l=m();return f(l.exportExcel())}),p(16,fe,1,0,"span",18),r(17),n()()}if(a&2){let e=m();s(11),q(e.sessions),s(2),u(e.totalRecords>e.pageSize?13:-1),s(2),d("disabled",e.isExportingExcelData),s(),u(e.isExportingExcelData?16:-1),s(),h(" ",e.isExportingExcelData?"Exporting...":"Export Excel"," ")}}var Y=class a{constructor(o,e,t,l,v){this._studentService=o;this._authService=e;this._router=t;this._snackBar=l;this._generateExcelService=v}paginatorForm=new x({pageNumber:new C(0),pageSize:new C(10)});filterForm=new x({searchString:new C(null)});isLoading=!1;isLoadingData=!0;isError=!1;errorData;totalRecords=0;sessions=[];ngOnInit(){this.getRoutesData(),this.paginatorForm.valueChanges.pipe(j(500)).subscribe(o=>{this.isLoadingData=!0,this.getRoutesData()}),this.filterForm.valueChanges.pipe(j(500)).subscribe(o=>{this.isLoadingData=!0,this.getRoutesData()})}get pageNumber(){return this.paginatorForm.get("pageNumber")?.value??0}get pageSize(){return this.paginatorForm.get("pageSize")?.value??10}get totalPages(){return Math.ceil(this.totalRecords/this.pageSize)}getEndItemIndex(){let o=(this.pageNumber+1)*this.pageSize;return o>this.totalRecords?this.totalRecords:o}goToFirstPage(){this.paginatorForm.patchValue({pageNumber:0})}goToPreviousPage(){this.pageNumber>0&&this.paginatorForm.patchValue({pageNumber:this.pageNumber-1})}goToNextPage(){this.pageNumber+1<this.totalPages&&this.paginatorForm.patchValue({pageNumber:this.pageNumber+1})}goToLastPage(){this.paginatorForm.patchValue({pageNumber:this.totalPages-1})}onPageSizeChange(o){let e=parseInt(o.target.value,10);this.paginatorForm.patchValue({pageSize:e,pageNumber:0})}getRoutesData(){let o={pageIndex:this.pageNumber,pageSize:this.pageSize,searchString:this.filterForm.value.searchString||""};this.isError=!1,this.errorData=null,this.isLoadingData=!0,this._studentService.apiStudentGetSessionsPost(o).subscribe({next:e=>{this.isLoadingData=!1,e.statusCode===200&&e.data?(this.isError=!1,this.sessions=e.data?.map(t=>D(b({},t),{name:`${Number(t.name)}-${Number(t.name)+1}`}))||[],this.totalRecords=e.totalRecords??0):(this.isError=!0,this.errorData={imgSrc:"empty-box.png",errorTitleMessage:"No Data available",errorSubTitleMessage:"Please try to add Sessions!"})},error:e=>{this.isLoadingData=!1,this.sessions=[],navigator.onLine?e.status===401?this._authService.logout():this.setGenericError():this.errorData={imgSrc:"no-signal.png",errorTitleMessage:"Internet connection lost",errorSubTitleMessage:"Please check your connection."},this.isError=!0}})}setGenericError(){this.errorData={imgSrc:"error.png",errorTitleMessage:"Something went wrong",errorSubTitleMessage:"Please try again later"}}resetToSearch(){this.filterForm.controls.searchString.reset()}getSessionStudentDetails(o){this._router.navigate(["/admin/students/list"],{queryParams:{session:o}})}isExportingExcelData=!1;exportExcel(){let o={pageIndex:this.pageNumber,pageSize:this.pageSize,searchString:this.filterForm.value.searchString||""};this.totalRecords>this.sessions.length?(this.isExportingExcelData=!0,this._studentService.apiStudentGetSessionsPost(o).subscribe({next:e=>{this.isExportingExcelData=!1;let t=e.data?.map(l=>D(b({},l),{name:`${Number(l.name)}-${Number(l.name)+1}`}))||[];this.formatDownExcelData(t??[])},error:e=>{this.isExportingExcelData=!1,this._snackBar.open("Failed to export data. Please try again later.","Close",{duration:3e3,panelClass:["snack-error"]})}})):this.formatDownExcelData(this.sessions)}formatDownExcelData(o){let e=(o??[]).map((l,v)=>D(b({},l),{slNo:v+1})),t=[{header:"Sl. No.",selector:l=>l.slNo},{header:"Academic Year",selector:l=>l.name}];this._generateExcelService.downloadJsonAsXlsx({rows:e,columns:t,fileName:"Academic Years_Data",sheetName:"Academic Years Data"})}static \u0275fac=function(e){return new(e||a)(c(B),c(A),c(R),c(z),c(ie))};static \u0275cmp=L({type:a,selectors:[["app-list",8,"component"]],attrs:me,decls:21,vars:4,consts:[[1,"main-container"],[1,"header"],[1,"header-left"],[1,"page-title"],[1,"breadcrumb"],["routerLink","/admin/dashboard"],[1,"separator"],[1,"header-right",3,"formGroup"],["type","text","placeholder","Search...","formControlName","searchString",1,"search-input"],["routerLink","/admin/sessions/add",1,"add-button"],["fxLayoutAlign","center center",1,"loading-page-ui"],[1,"error-page-ui"],[3,"errorData"],[1,"table-wrapper"],[1,"table-ui"],[1,"paginator-wrapper"],[1,"form-actions"],[1,"submit",3,"click","disabled"],[1,"spinner"],[1,"edit-button",3,"click"],[1,"pagination-controls"],[3,"change","value"],[3,"value"],[3,"click","disabled"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),r(5,"Academic Years"),n()(),i(6,"div",4)(7,"span")(8,"a",5),r(9,"Home"),n()(),i(10,"span",6),r(11,"/"),n(),i(12,"span"),r(13,"Academic Years"),n()()(),i(14,"form",7),S(15,"input",8),i(16,"button",9),r(17,"Add"),n()()(),p(18,pe,2,0,"div",10),p(19,ue,2,1,"div",11),p(20,he,18,4),n()),e&2&&(s(14),d("formGroup",t.filterForm),s(4),u(t.isLoadingData&&!t.isError?18:-1),s(),u(!t.isLoadingData&&t.isError?19:-1),s(),u(!t.isLoadingData&&!t.isError?20:-1))},dependencies:[y,I,N,te,G,T,K,Q,k,P,M,O,V,ee],encapsulation:2})};var ve=["class","component"];function Ce(a,o){a&1&&(i(0,"span"),r(1,"Academic year is required"),n())}function xe(a,o){a&1&&(i(0,"span"),r(1,"Please enter valid academic year or current year"),n())}function Ee(a,o){if(a&1&&(i(0,"div",17),p(1,Ce,2,0,"span"),p(2,xe,2,0,"span"),n()),a&2){let e=m();s(),u(e.addOrEditSessionForm.controls.name.errors!=null&&e.addOrEditSessionForm.controls.name.errors.required?1:-1),s(),u(!(e.addOrEditSessionForm.controls.name.errors!=null&&e.addOrEditSessionForm.controls.name.errors.required)&&(e.addOrEditSessionForm.controls.name.errors!=null&&e.addOrEditSessionForm.controls.name.errors.min||e.addOrEditSessionForm.controls.name.errors!=null&&e.addOrEditSessionForm.controls.name.errors.max)?2:-1)}}function be(a,o){a&1&&S(0,"span",20)}var E=class a{constructor(o,e,t,l){this._studentService=o;this._router=e;this._authenticationService=t;this._snackBar=l}addOrEditSessionForm=new x({name:new C(0,[w.required,w.min(new Date().getFullYear()),w.max(new Date().getFullYear())])});isLoading=!1;sessionId;isLoadingData=!1;isError=!1;errorData;ngOnInit(){}onSubmit(){let o=this.addOrEditSessionForm.value;if(!this.sessionId)if(this.addOrEditSessionForm.valid){let e={name:o.name?.toString()??""};this.isLoading=!0,this.addOrEditSessionForm.disable(),this._studentService.apiStudentAddSessionPost(e).subscribe({next:t=>{this.isLoading=!1,this.addOrEditSessionForm.enable(),t.statusCode===200?(this._router.navigateByUrl("/admin/sessions/list"),this._snackBar.open(t.message??"Academic year created successfully","Close",{duration:3e3,panelClass:["snack-success"]})):this._snackBar.open(t.message??"Something went wrong, Please try after sometime","Close",{duration:3e3,panelClass:["snack-error"]})},error:t=>{this.isLoading=!1,this.addOrEditSessionForm.enable(),navigator.onLine?this._snackBar.open("Something went wrong, Please try after sometime","Close",{duration:3e3,panelClass:["snack-error"]}):t.status==401?this._authenticationService.logout():this._snackBar.open("Internet Connection Lost, Please check your connectivity","Close",{duration:3e3,panelClass:["snack-error"]})}})}else{this._snackBar.open("Please enter academic year","Close",{duration:3e3,panelClass:["snack-error"]}),this.addOrEditSessionForm.markAllAsTouched();return}}static \u0275fac=function(e){return new(e||a)(c(B),c(R),c(A),c(z))};static \u0275cmp=L({type:a,selectors:[["app-add-or-edit",8,"component"]],attrs:ve,decls:36,vars:7,consts:[[1,"main-container"],[1,"header"],[1,"header-left"],[1,"page-title"],[1,"breadcrumb"],["routerLink","/admin/dashboard"],[1,"separator"],["routerLink","/admin/sessions/list"],[1,"form-container"],[3,"ngSubmit","formGroup"],[1,"form-body"],[1,"basic-container"],[1,"form-row"],[1,"form-group"],["for","name"],[1,"text-warn"],["type","tel","formControlName","name","id","name","oninput","this.value = this.value.replace(/[^0-9]/g, '');","maxlength","4","minlength","4","autocomplete","off","aria-label","Academic Year"],[1,"error"],[1,"form-actions"],["type","submit",1,"submit",3,"disabled"],[1,"spinner"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),r(5),n()(),i(6,"div",4)(7,"span")(8,"a",5),r(9,"Home"),n()(),i(10,"span",6),r(11,"/"),n(),i(12,"span")(13,"a",7),r(14,"Academic Years"),n()(),i(15,"span",6),r(16,"/"),n(),i(17,"span"),r(18),n()()()(),i(19,"div",8)(20,"form",9),g("ngSubmit",function(){return t.onSubmit()}),i(21,"div",10)(22,"div",11)(23,"div",12)(24,"div",13)(25,"label",14),r(26,"Academic Year"),i(27,"span",15),r(28,"*"),n()(),S(29,"input",16),p(30,Ee,3,2,"div",17),n(),S(31,"div",13),n()()(),i(32,"div",18)(33,"button",19),p(34,be,1,0,"span",20),r(35),n()()()()()),e&2&&(s(5),h("",t.sessionId?"Edit":"Add"," Academic Year"),s(13),h("",t.sessionId?"Edit":"Add"," Academic Year"),s(2),d("formGroup",t.addOrEditSessionForm),s(10),u(t.addOrEditSessionForm.controls.name.touched&&t.addOrEditSessionForm.controls.name.invalid?30:-1),s(3),d("disabled",t.isLoading),s(),u(t.isLoading?34:-1),s(),h(" ",t.isLoading?"Submitting...":"Submit"," "))},dependencies:[y,I,G,T,k,P,M,W,Z,O,V,N],encapsulation:2})};var Ye=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:Y},{path:"add",component:E},{path:"edit",component:E}];export{Ye as sessionsRoutes};
